/**
 * jquery plugin which displays data in tabular format (datagrid)
 * Requires jquery, jquery-ui Themes CSS
 * It uses jui_pagination plugin (which requires jquery-ui)
 * Copyright 2012 Christos Pontikis http://pontikis.net
 * Project page https://github.com/pontikis/jui_datagrid
 * UPCOMING Release: 1.00 (?? Oct 2012)
 * License MIT
 * Minified using Online YUI Compressor http://www.refresh-sf.com/yui/
 */
"use strict";(function(e){var i="jui_datagrid";var n="jui_datagrid_status";var b={init:function(q){var r=this;return this.each(function(){var u=r.data(i);if(typeof(u)==="undefined"){var x=r.jui_datagrid("getDefaults");u=e.extend({},x,q)}else{u=e.extend({},u,q)}r.data(i,u);if(typeof r.data(n)==="undefined"){r.data(n,{})}var y=r.attr("id");r.unbind("onCellClick").bind("onCellClick",u.onCellClick);r.unbind("onRowClick").bind("onRowClick",u.onRowClick);r.unbind("onDelete").bind("onDelete",u.onDelete);r.unbind("onDisplay").bind("onDisplay",u.onDisplay);var v,C,D,z,w,A;v=c(u.header_id_prefix,y);C=c(u.datagrid_id_prefix,y);D=c(u.tools_id_prefix,y);z=c(u.pagination_id_prefix,y);w=c(u.pref_dialog_id_prefix,y);if(!r.data(n)["initialize"]){A='<div id="'+v+'">'+u.title+"</div>";A+='<div id="'+C+'"></div>';A+='<div id="'+D+'"></div>';A+='<div id="'+z+'"></div>';A+='<div id="'+w+'"></div>';r.html(A);r.data(n)["initialize"]=true}var F=e("#"+v);var t=e("#"+C);var E=e("#"+D);var s=e("#"+z);var B=e("#"+w);r.removeClass().addClass(u.containerClass);if(typeof u.title==="undefined"){F.hide()}else{F.show().text(u.title).removeClass().addClass(u.headerClass)}t.removeClass().addClass(u.datagridClass);E.removeClass().addClass(u.toolsClass);s.removeClass().addClass(u.paginationClass);e.ajax({type:"POST",url:u.ajaxFetchDataURL,data:{page_num:u.pageNum,rows_per_page:u.rowsPerPage},success:function(N){var R=e.parseJSON(N);var J=R.total_rows;var H=R.page_data;if(J==0){a(y)}else{m(y,J,H);j(y);if(u.useToolbar){l(y)}d(y,J);var K;var P=c(r.jui_datagrid("getOption","table_id_prefix"),y);var L=e("#"+P);var I,O;K="tbody tr td";L.off("click",K).on("click",K,function(){I=e(this).index()+1;O=e(this).parent("tr").index()+1;r.triggerHandler("onCellClick",{col:I,row:O})});K="tbody tr";L.off("click",K).on("click",K,function(){O=e(this).index()+1;e(this).children("td").toggleClass(u.selectedTrTdClass);r.triggerHandler("onRowClick",O)});if(u.showDeleteButton){K="#"+c(u.tools_id_prefix,y)+"_delete";r.off("click",K).on("click",K,function(){r.triggerHandler("onDelete")})}if(u.showRefreshButton){K="#"+c(u.tools_id_prefix,y)+"_refresh";r.off("click",K).on("click",K,function(){e("#"+y).jui_datagrid("refresh")})}if(u.showPrefButton){K="#"+c(u.tools_id_prefix,y)+"_pref";r.off("click",K).on("click",K,function(){if(p(w,"dialog")){B.dialog("destroy")}B.dialog({autoOpen:true,show:"blind",hide:"explode",width:400,height:350,position:{my:"top",at:"top",of:"#"+y},title:rsc_jui_dg.preferences,buttons:[{text:rsc_jui_dg.preferences_close,click:function(){e(this).dialog("close");e(this).dialog("destroy")}}],open:f(y)});var S=c(u.pref_tabs_id_prefix,y);e("#"+S).tabs()});var G,Q;G=["_btn_select","_btn_refresh","_btn_delete","_btn_print","_btn_export","_btn_filters"];Q=["showSelectButtons","showRefreshButton","showDeleteButton","showPrintButton","showExportButton","showFiltersButton"];for(var M in G){h(r,B,"#"+w+G[M],Q[M])}G=["_slider","_goto_page","_rows_per_page","_rows_info","_nav_buttons"];Q=["useSlider","showGoToPage","showRowsPerPage","showRowsInfo","showNavButtons"];for(var M in G){g(r,B,"#"+w+G[M],Q[M])}}r.triggerHandler("onDisplay")}}})})},getDefaults:function(){return{pageNum:1,rowsPerPage:10,maxRowsPerPage:100,useToolbar:true,showPrefButton:true,showSelectButtons:true,showRefreshButton:true,showDeleteButton:true,showPrintButton:true,showExportButton:true,showFiltersButton:true,showPrefButtonText:false,showSelectAllButtonText:false,showSelectNoneButtonText:false,showSelectInverseButtonText:false,showRefreshButtonText:false,showDeleteButtonText:true,showPrintButtonText:false,showExportButtonText:false,showFiltersButtonText:false,usePagination:true,paginationOptions:{visiblePageLinks:5,useSlider:true,showGoToPage:false,showRowsPerPage:true,showRowsInfo:true,showPreferences:false,disableSelectionNavPane:true},containerClass:"grid_container ui-state-default ui-corner-all",headerClass:"grid_geader ui-widget-header ui-corner-top",datagridClass:"grid_data",toolsClass:"grid_tools ui-state-default ui-corner-all",paginationClass:"grid_pagination",applyUIGridStyle:true,tableClass:"grid_table",trHoverClass:"ui-state-hover trhover",thClass:"ui-state-default",tdClass:"ui-widget-content",selectedTrTdClass:"ui-state-highlight",tbButtonContainer:"tbBtnContainer",tbPrefIconClass:"ui-icon-gear",tbSelectAllIconClass:"ui-icon-circle-check",tbSelectNoneIconClass:"ui-icon-circle-close",tbSelectInverseIconClass:"ui-icon-check",tbRefreshIconClass:"ui-icon-refresh",tbDeleteIconClass:"ui-icon-trash",tbPrintIconClass:"ui-icon-print",tbExportIconClass:"ui-icon-extlink",tbFiltersIconClass:"ui-icon-search",datagrid_id_prefix:"dg_",header_id_prefix:"header_",table_id_prefix:"tbl_",tools_id_prefix:"tools_",pagination_id_prefix:"pag_",pref_dialog_id_prefix:"pref_dlg_",pref_tabs_id_prefix:"pref_tabs_",onCellClick:function(){},onRowClick:function(){},onDelete:function(){},onDisplay:function(){}}},getOption:function(q){var r=this;return r.data(i)[q]},getAllOptions:function(){var q=this;return q.data(i)},setOption:function(q,t,s){var r=this;r.data(i)[q]=t;if(s){r.jui_datagrid("init")}},refresh:function(){var q=this;q.jui_datagrid()},destroy:function(){return e(this).each(function(){var s=e(this);var r=s.attr("id");var q=s.jui_datagrid("getOption","pagination_id_prefix")+r;e("#"+q).removeData();s.removeData()})},setGridStyle:function(r,s,v,q){var u=this;var t="#"+c(e(u).jui_datagrid("getOption","table_id_prefix"),u.attr("id"));e(t).removeClass().addClass(r);if(s!=""){e(t).on("mouseover mouseout","tbody tr",function(w){e(this).children().toggleClass(s,w.type=="mouseover")})}e(t).find("th").removeClass().addClass(v);e(t).find("td").removeClass().addClass(q)},getPaginationOption:function(s){var r=this.attr("id");var q=e("#"+r).jui_datagrid("getOption","pagination_id_prefix")+r;return e("#"+q).jui_pagination("getOption",s)},getAllPaginationOptions:function(){var r=this.attr("id");var q=e("#"+r).jui_datagrid("getOption","pagination_id_prefix")+r;return e("#"+q).jui_pagination("getAllOptions")}};var c=function(r,q){return r+q};var k=function(q){return(e("#"+q).length===0?false:true)};var p=function(q,r){if(!k(q)){return false}else{return(typeof e("#"+q).data(r)==="object"?true:false)}};var g=function(s,r,q,t){r.off("click",q).on("click",q,function(){var u={};u[t]=e(this).is(":checked");s.jui_datagrid({paginationOptions:u})})};var h=function(s,r,q,t){r.off("click",q).on("click",q,function(){var u={};u[t]=e(this).is(":checked");s.jui_datagrid(u)})};var o=function(q,r){var s;s="<li>";s+='<input type="checkbox" id="'+q+'" /><label for="'+q+'">'+r+"</label>";s+="</li>";return s};var f=function(x){var r=e("#"+x);var v=r.jui_datagrid("getOption","pref_dialog_id_prefix");var t=c(v,x);v=r.jui_datagrid("getOption","pref_tabs_id_prefix");var y=c(v,x);var s="";s+='<div id="'+y+'">';s+="<ul>";s+='<li><a href="#'+y+'_grid">'+rsc_jui_dg.pref_tab_grid+"</a></li>";s+='<li><a href="#'+y+'_tools">'+rsc_jui_dg.pref_tab_tools+"</a></li>";s+='<li><a href="#'+y+'_nav">'+rsc_jui_dg.pref_tab_nav+"</a></li>";s+="</ul>";s+='<div id="'+y+'_grid">';s+="Under construction 1";s+="</div>";s+='<div id="'+y+'_tools">';s+='<ul style="list-style-type: none;">';s+=o(t+"_btn_select",rsc_jui_dg.pref_show_select);s+=o(t+"_btn_refresh",rsc_jui_dg.pref_show_refresh);s+=o(t+"_btn_delete",rsc_jui_dg.pref_show_delete);s+=o(t+"_btn_print",rsc_jui_dg.pref_show_print);s+=o(t+"_btn_export",rsc_jui_dg.pref_show_export);s+=o(t+"_btn_filters",rsc_jui_dg.pref_show_filters);s+="</ul>";s+="</div>";s+='<div id="'+y+'_nav">';s+='<ul style="list-style-type: none;">';s+=o(t+"_slider",rsc_jui_pag.pref_show_slider);s+=o(t+"_goto_page",rsc_jui_pag.pref_show_goto_page);s+=o(t+"_rows_per_page",rsc_jui_pag.pref_show_rows_per_page);s+=o(t+"_rows_info",rsc_jui_pag.pref_show_rows_info);s+=o(t+"_nav_buttons",rsc_jui_pag.pref_show_nav_buttons);s+="</ul>";s+="</div>";s+="</div>";e("#"+t).html(s);var q,w;q=["_btn_select","_btn_refresh","_btn_delete","_btn_print","_btn_export","_btn_filters"];w=["showSelectButtons","showRefreshButton","showDeleteButton","showPrintButton","showExportButton","showFiltersButton"];for(var u in q){e("#"+t+q[u]).attr("checked",r.jui_datagrid("getOption",w[u]))}q=["_slider","_goto_page","_rows_per_page","_rows_info","_nav_buttons"];w=["useSlider","showGoToPage","showRowsPerPage","showRowsInfo","showNavButtons"];for(var u in q){e("#"+t+q[u]).attr("checked",r.jui_datagrid("getPaginationOption",w[u]))}};var m=function(t,s,q){var r=e("#"+t);var w=q.length;var x=c(r.jui_datagrid("getOption","datagrid_id_prefix"),t);var y=c(r.jui_datagrid("getOption","table_id_prefix"),t);var v='<table id="'+y+'">';v+="<thead>";v+="<tr>";e.each(q[0],function(z){v+="<th>"+z+"</th>"});v+="<tr>";v+="</thead>";v+="<tbody>";for(var u=0;u<w;u++){v+="<tr>";e.each(q[u],function(z,A){v+="<td>"+A+"</td>"});v+="</tr>"}v+="<tbody>";v+="</table>";e("#"+x).html(v)};var j=function(r){var q=e("#"+r);if(q.jui_datagrid("getOption","applyUIGridStyle")){q.jui_datagrid("setGridStyle",q.jui_datagrid("getOption","tableClass"),q.jui_datagrid("getOption","trHoverClass"),q.jui_datagrid("getOption","thClass"),q.jui_datagrid("getOption","tdClass"))}};var l=function(L){var V=e("#"+L);var ab=c(V.jui_datagrid("getOption","tools_id_prefix"),L);var R=V.jui_datagrid("getOption","toolsClass");var I=V.jui_datagrid("getOption","tbButtonContainer");var S=V.jui_datagrid("getOption","showPrefButton");var K=V.jui_datagrid("getOption","showPrefButtonText");var t=V.jui_datagrid("getOption","tbPrefIconClass");var T=V.jui_datagrid("getOption","showSelectButtons");var x=V.jui_datagrid("getOption","tbSelectAllIconClass");var W=V.jui_datagrid("getOption","tbSelectNoneIconClass");var O=V.jui_datagrid("getOption","tbSelectInverseIconClass");var C=V.jui_datagrid("getOption","showSelectAllButtonText");var X=V.jui_datagrid("getOption","showSelectNoneButtonText");var v=V.jui_datagrid("getOption","showSelectInverseButtonText");var J=V.jui_datagrid("getOption","showRefreshButton");var U=V.jui_datagrid("getOption","showRefreshButtonText");var s=V.jui_datagrid("getOption","tbRefreshIconClass");var Y=V.jui_datagrid("getOption","showDeleteButton");var F=V.jui_datagrid("getOption","showDeleteButtonText");var M=V.jui_datagrid("getOption","tbDeleteIconClass");var w=V.jui_datagrid("getOption","showPrintButton");var Z=V.jui_datagrid("getOption","showPrintButtonText");var A=V.jui_datagrid("getOption","tbPrintIconClass");var Q=V.jui_datagrid("getOption","showExportButton");var D=V.jui_datagrid("getOption","showExportButtonText");var G=V.jui_datagrid("getOption","tbExportIconClass");var z=V.jui_datagrid("getOption","showFiltersButton");var N=V.jui_datagrid("getOption","showFiltersButtonText");var P=V.jui_datagrid("getOption","tbFiltersIconClass");var y="";if(S){y+='<div class="'+I+'">';var q=ab+"_pref";y+='<button id="'+q+'">'+rsc_jui_dg.preferences+"</button>";y+="</div>"}if(T){y+='<div class="'+I+'">';var u=ab+"_select_all";y+='<button id="'+u+'">'+rsc_jui_dg.select_all+"</button>";var ad=ab+"_select_none";y+='<button id="'+ad+'">'+rsc_jui_dg.select_none+"</button>";var aa=ab+"_select_inverse";y+='<button id="'+aa+'">'+rsc_jui_dg.select_inverse+"</button>";y+="</div>"}if(J){y+='<div class="'+I+'">';var ac=ab+"_refresh";y+='<button id="'+ac+'">'+rsc_jui_dg.tb_refresh+"</button>";y+="</div>"}if(Y){y+='<div class="'+I+'">';var B=ab+"_delete";y+='<button id="'+B+'">'+rsc_jui_dg.tb_delete+"</button>";y+="</div>"}if(w||Q){y+='<div class="'+I+'">'}if(w){var E=ab+"_print";y+='<button id="'+E+'">'+rsc_jui_dg.tb_print+"</button>"}if(Q){var r=ab+"_export";y+='<button id="'+r+'">'+rsc_jui_dg.tb_export+"</button>"}if(w||Q){y+="</div>"}if(z){y+='<div class="'+I+'">';var H=ab+"_filters";y+='<button id="'+H+'">'+rsc_jui_dg.tb_filters+"</button>";y+="</div>"}e("#"+ab).html(y);if(S){e("#"+q).button({label:rsc_jui_dg.preferences,text:K,icons:{primary:t}})}if(T){e("#"+u).button({label:rsc_jui_dg.select_all,text:C,icons:{primary:x}});e("#"+ad).button({label:rsc_jui_dg.select_none,text:X,icons:{primary:W}});e("#"+aa).button({label:rsc_jui_dg.select_inverse,text:v,icons:{primary:O}})}if(J){e("#"+ac).button({label:rsc_jui_dg.tb_refresh,text:U,icons:{primary:s}})}if(Y){e("#"+B).button({label:rsc_jui_dg.tb_delete,text:F,icons:{primary:M}})}if(w){e("#"+E).button({label:rsc_jui_dg.tb_print,text:Z,icons:{primary:A}})}if(Q){e("#"+r).button({label:rsc_jui_dg.tb_export,text:D,icons:{primary:G}})}if(z){e("#"+H).button({label:rsc_jui_dg.tb_filters,text:N,icons:{primary:P}})}};var d=function(C,u){var F=e("#"+C);var A=F.jui_datagrid("getOption","pageNum");var w=F.jui_datagrid("getOption","rowsPerPage");var q=F.jui_datagrid("getOption","maxRowsPerPage");var y=Math.ceil(u/w);var s=F.jui_datagrid("getOption","paginationClass");var r=c(F.jui_datagrid("getOption","pagination_id_prefix"),C);var t=F.jui_datagrid("getOption","paginationOptions");var G=e("#"+r);var H=["currentPage","rowsPerPage","totalPages","containerClass","onSetRowsPerPage","onChangePage","onDisplay"];for(var B in H){if(typeof(t[H[B]])!="undefined"){delete t[H[B]]}}var x=G.data("jui_pagination");if(typeof(x)==="undefined"){var D=F.jui_datagrid("getDefaults");var v=D.paginationOptions;x=e.extend({},v,t)}else{x=e.extend({},x,t)}var E=x.showRowsInfo;var z={currentPage:A,rowsPerPage:w,totalPages:y,containerClass:s,onSetRowsPerPage:function(I,J){if(isNaN(J)||J<=0){F.jui_datagrid("refresh")}else{q=parseInt(q);if(q>0){if(J>q){J=q}}F.jui_datagrid({pageNum:1,rowsPerPage:J})}},onChangePage:function(J,I){F.jui_datagrid({pageNum:I})},onDisplay:function(){if(E){var I=((A-1)*w)+1;var J=Math.min(I+w-1,u);var K=I+"-"+J+" "+rsc_jui_dg.rows_info_of+" "+u+" "+rsc_jui_dg.rows_info_records;e(this).jui_pagination("setRowsInfo",K)}}};x=e.extend({},x,z);G.jui_pagination(x)};var a=function(t){var s=e("#"+t);var r=s.jui_datagrid("getOption","datagrid_id_prefix")+t;var q=s.jui_datagrid("getOption","pagination_id_prefix")+t;e("#"+r).html(rsc_jui_dg.no_records_found);e("#"+q).hide()};e.fn.jui_datagrid=function(r){if(this.size()!=1){var q="You must use this plugin ("+i+") with a unique element (at once)";this.html('<span style="color: red;">ERROR: '+q+"</span>");e.error(q)}if(b[r]){return b[r].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof r==="object"||!r){return b.init.apply(this,arguments)}else{e.error("Method "+r+" does not exist on jQuery."+i)}}}})(jQuery);